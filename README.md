# 🎮 Mafia Game with I2C LCD (Thread & Mutex 기반 멀티플레이어 게임 시스템)

📄 **프로젝트 문서**: [마피아 게임 노션 링크](https://lopsided-tray-d39.notion.site/Mafia-Game-Linux-Device-Driver-TCP-IP-23b04872d73a80ba8076dcd72ca544d9)

> **TCP/IP 기반 멀티 클라이언트 마피아 게임 서버 + I2C LCD 디바이스 드라이버 + 멀티스레드 동기화 구현 프로젝트**

---

## 📌 프로젝트 개요

- TCP 기반 마피아 게임 서버 및 클라이언트 구현
- 게임 페이즈 제어, 역할 분배, 투표 시스템 포함
- I2C LCD 드라이버를 직접 작성하여 실시간 게임 상태 출력
- Thread & Mutex를 통한 멀티스레드 동기화 및 상태 보호

---

## ⚙️ 주요 구성 요소

| 구성요소       | 설명                                                                 |
|----------------|----------------------------------------------------------------------|
| **Language**    | C (Linux Socket, pthread, I2C API, Kernel Module)                   |
| **디바이스**    | LCD1602 (I2C 방식 캐릭터 디스플레이)                                 |
| **기능별 파일** | `client.c`, `server.c`, `game.c`, `utils.c`, `network.c`, `lcd_i2c.c`|
| **통신 방식**   | TCP/IP 기반 소켓 통신 (멀티 클라이언트 처리)                         |
| **디바이스 드라이버** | `/dev/lcd_i2c`로 출력 가능, 커널 모듈 직접 작성 및 등록                |

---

## 💡 핵심 기능

- ✅ 5인 이상 접속 시 게임 시작, 역할 무작위 배정
- ✅ 페이즈 기반 흐름 제어 (낮/투표/최후변론/밤)
- ✅ Thread로 클라이언트별 독립 처리, Mutex로 상태 공유 보호
- ✅ I2C LCD에 게임 상태(phase, 시간 등) 실시간 출력
- ✅ Night phase에서 역할별(마피아/경찰/의사) 행동 처리

---

## 🔧 사용 기술

- Verilog HDL을 활용한 FSM 기반 센서 데이터 처리 및 출력 제어
- UART 출력으로 온도/습도/거리 실시간 시리얼 통신 모니터링
- PWM 신호로 모터 속도 제어 및 회전 방향 설정
- FND 출력 시 분기별 정보 표시 로직 (온도, 습도, 거리, 상태 등)

---

## 🧠 문제 해결 및 개선

- 🔸 Mutex 미사용 시 상태 꼬임 발생 → 전역 공유자원 보호 필수
- 🔸 역할 분배 무작위성 확보 → Fisher–Yates shuffle 알고리즘 적용
- 🔸 입력 버퍼 처리 안정화 → `trim_newline()`, send/recv 에러 처리 강화
- 🔸 디바이스 드라이버 초기화 및 write 에러 처리 로직 구현

---

## 🖼️ 전체 시스템 통합

- 게임 클라이언트/서버, 디바이스 드라이버가 통합된 종합 시스템 구현
- `/dev/lcd_i2c`를 통한 페이즈 상태 실시간 시각화
- 사용자의 채팅, 투표, 최후 진술, 밤 행동까지 스레드와 페이즈로 관리
- Thread + Mutex + I2C Driver + TCP Socket이 통합된 임베디드 네트워크/시스템 소프트웨어 프로젝트 완성
